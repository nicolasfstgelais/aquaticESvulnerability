waterchem=read.csv("data/raw/NLA_WQ/nla2012_waterchem_wide.csv")

# create a subset with the columns specific to a variable of interest that you want to gather
turb_ph=waterchem[,c("UID","TURB_RESULT","PH_RESULT","TURB_UNITS","PH_UNITS","TURB_QA_FLAG"
                     ,"TURB_RL","TURB_LAB_FLAG","PH_LAB_FLAG","PH_QA_FLAG","PH_FLAG","ANC_LAB_FLAG"
                     ,"ANC_QA_FLAG","ANC_RESULT")]


# many steps needed because multiple groups of varaibles
inter1=gather(turb_ph,key="parameter",value="value",-UID)
#use the regmatches function to parse only at the first _ (not sure why it is working)
inter2=data.frame(do.call('rbind', regmatches(as.character(inter1$parameter), regexpr("_", as.character(inter1$parameter)), invert = TRUE)))
inter1$parameter=inter2$X1
inter1$type=inter2$X2
turb_ph_long=spread(inter1,type, value)

dates=read.csv(("data/raw/NLA_WQ/NLA2012_dates_OR.csv"))

turb_ph_long_date=merge(x = turb_ph_long, dates,by = "UID")

write.csv(turb_ph_long_date,"data/raw/NLA_WQ/nla2012_turb_ph_anc_long_R.csv")
