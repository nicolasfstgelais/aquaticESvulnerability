algaltoxins=read.csv("data/raw/NLA_WQ/nla2012_algaltoxins_08192016.csv")

colnames(algaltoxins)
# create a subset with the columns specific to a variable of interest that you want to gather
micx=algaltoxins[,c("UID","MICX_MDL","MICX_QA_FLAG","MICX_RESULT","MICX_RL","MICX_FLAG","MICX_UNITS")]


# many steps needed because multiple groups of varaibles
inter1=gather(micx,key="parameter",value="value",-UID)
#use the regmatches function to parse only at the first _ (not sure why it is working)
inter2=data.frame(do.call('rbind', regmatches(as.character(inter1$parameter), regexpr("_", as.character(inter1$parameter)), invert = TRUE)))
inter1$parameter=inter2$X1
inter1$type=inter2$X2
micx_long=spread(inter1,type, value)

dates=read.csv(("data/raw/NLA_WQ/NLA2012_dates_OR.csv"))

micx_long_date=merge(x = micx_long, dates,by = "UID")

write.csv(micx_long_date,"data/raw/NLA_WQ/nla2012_micx_long_R.csv")
